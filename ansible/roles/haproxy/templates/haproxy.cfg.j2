global
    log stdout format raw local0 {{ haproxy_global_log_level | default('warning') }}
    stats socket {{ haproxy_stats_socket_path | default('/var/run/haproxy.sock') }} mode 600 level admin expose-fd listeners

defaults
    log     global
    mode    http
    timeout connect {{ haproxy_timeout_connect | default('5s') }}
    timeout client  {{ haproxy_timeout_client  | default('50s') }}
    timeout server  {{ haproxy_timeout_server  | default('50s') }}
    option  httplog
    option  dontlognull

# Stats dashboard with password protection
listen stats
    bind *:{{ haproxy_stats_port | default(8406) }}
    mode http
    stats enable
    stats uri {{ haproxy_stats_uri | default('/stats') }}
    stats refresh {{ haproxy_stats_refresh | default('10s') }}
    {% if haproxy_stats_user is defined and haproxy_stats_password is defined %}
    stats auth {{ haproxy_stats_user }}:{{ haproxy_stats_password }}
    {% endif %}

# Native Prometheus metrics endpoint
{% if haproxy_prometheus_enabled | default(false) %}
frontend prometheus-metrics
    bind *:{{ haproxy_prometheus_port | default(8407) }}
    mode http
    http-request use-service prometheus-exporter
{% endif %}


########################################################################################
# Servicii HTTP â€“ TOTUL DEFINIT MANUAL AICI
########################################################################################

listen http_444-bansible-bash-service-9444
    bind *:9444
    mode http
    balance leastconn
    option httpclose
    maxconn 300000
    option http-server-close
    timeout http-keep-alive 3000
    option httpchk GET /health HTTP/1.1

    server node1 10.192.24.141:3444 maxconn 200000 check fall 1
    server node3 10.192.24.143:3444 maxconn 200000 check fall 1
    server node5 10.192.24.145:3444 maxconn 200000 check fall 1

